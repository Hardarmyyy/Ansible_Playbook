---

- name: Creating a super user across all systems
  tags: add-user
  user:
    name: "{{ username }}"
    groups:
      - root
      - sudo

- name: Add ssh-key for the super user across all systems
  tags: copy-ssh-keys
  authorized_key:
    user: "{{ username }}"
    key: "{{ ssh_pub_key }}"

- name: Make the super user a sudoer
  tags: sudo-rights
  lineinfile:
    dest: /etc/sudoers
    line: "{{ username }} ALL=(ALL) NOPASSWD:ALL"
    state: present


- name: Enable UFW on all systems
  tags: enable-ufw
  ufw:
    state: enabled

- name: Allow SSH, HTTP and HTTPS on all systems
  tags: allow-ssh,allow-http,allow-https
  ufw:
    rule: allow
    port: "{{ item }}"
    proto: tcp
  loop:
    - 22
    - 80
    - 443
